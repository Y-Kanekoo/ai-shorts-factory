{
  "name": "W4: Publisherï¼ˆYouTubeæŠ•ç¨¿ï¼‰",
  "nodes": [
    {
      "parameters": {},
      "id": "webhook-trigger",
      "name": "Webhookå—ä¿¡",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [250, 300],
      "webhookId": "w4-publisher"
    },
    {
      "parameters": {
        "jsCode": "// æŠ•ç¨¿ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—\nconst fs = require('fs');\nconst input = $input.first().json;\n\n// ä¸€æ„ãªãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆ\nconst timestamp = Date.now();\nconst inputFile = `/home/node/output/temp/publish_input_${timestamp}.json`;\n\n// Shortsç”¨ã®èª¿æ•´\nlet description = input.description || '';\nif (!description.includes('#Shorts')) {\n  description += '\\n\\n#Shorts';\n}\n\n// å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢\nconst params = {\n  video_path: input.video_path,\n  title: input.title,\n  description: description,\n  tags: [...(input.tags || []), 'Shorts'],\n  privacy_status: input.privacy_status || 'private'\n};\n\n// tempãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºä¿\nconst tempDir = '/home/node/output/temp';\nif (!fs.existsSync(tempDir)) {\n  fs.mkdirSync(tempDir, { recursive: true });\n}\n\n// JSONãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—\nfs.writeFileSync(inputFile, JSON.stringify(params, null, 2));\n\nreturn {\n  input_file: inputFile,\n  title: params.title\n};"
      },
      "id": "prepare-upload",
      "name": "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "command": "cd /home/node && python3 -m scripts.publish_video --input-json {{ $json.input_file }}"
      },
      "id": "upload-video",
      "name": "YouTubeæŠ•ç¨¿ï¼ˆPythonï¼‰",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "jsCode": "// æŠ•ç¨¿çµæœã‚’è§£æ\nconst fs = require('fs');\nconst stdout = $input.first().json.stdout;\nconst stderr = $input.first().json.stderr;\nconst inputFile = $('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™').first().json.input_file;\nconst title = $('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™').first().json.title;\n\nif (stderr && stderr.includes('Error')) {\n  console.log('Warning:', stderr);\n}\n\n// ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤\ntry {\n  if (fs.existsSync(inputFile)) {\n    fs.unlinkSync(inputFile);\n  }\n} catch (e) {\n  console.log('ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ã‚¨ãƒ©ãƒ¼ï¼ˆç„¡è¦–ï¼‰:', e.message);\n}\n\n// å‹•ç”»IDã¨URLã‚’æŠ½å‡º\nconst videoIdMatch = stdout.match(/Video ID: ([\\w-]+)/);\nconst urlMatch = stdout.match(/URL: (https:\\/\\/[^\\s]+)/);\n\nif (!videoIdMatch) {\n  throw new Error('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + stdout);\n}\n\nreturn {\n  video_id: videoIdMatch[1],\n  video_url: urlMatch ? urlMatch[1] : `https://www.youtube.com/watch?v=${videoIdMatch[1]}`,\n  shorts_url: `https://www.youtube.com/shorts/${videoIdMatch[1]}`,\n  title: title,\n  success: true\n};"
      },
      "id": "parse-result",
      "name": "çµæœè§£æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "channel": "={{ $env.SLACK_CHANNEL }}",
        "text": "ğŸ¬ æ–°ã—ã„Shortså‹•ç”»ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸï¼\n\nã‚¿ã‚¤ãƒˆãƒ«: {{ $json.title }}\nURL: {{ $json.shorts_url }}",
        "otherOptions": {}
      },
      "id": "slack-notify",
      "name": "Slacké€šçŸ¥",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1050, 300],
      "credentials": {
        "slackApi": {
          "id": "slack-cred",
          "name": "Slack API"
        }
      },
      "disabled": true
    }
  ],
  "connections": {
    "Webhookå—ä¿¡": {
      "main": [
        [
          {
            "node": "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™": {
      "main": [
        [
          {
            "node": "YouTubeæŠ•ç¨¿ï¼ˆPythonï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "YouTubeæŠ•ç¨¿ï¼ˆPythonï¼‰": {
      "main": [
        [
          {
            "node": "çµæœè§£æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "çµæœè§£æ": {
      "main": [
        [
          {
            "node": "Slacké€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "timezone": "Asia/Tokyo"
  },
  "tags": ["ai-shorts-factory", "publisher"],
  "active": false
}
